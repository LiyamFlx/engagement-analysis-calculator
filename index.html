<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightWave - Engagement Analysis Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- Screen 1: Start Screen -->
        <div class="screen active" id="screen1">
            <h2>Welcome to InsightWave</h2>
            <p>Analyze engagement with real-time insights and detailed breakdowns.</p>
            <button onclick="showScreen(2)">Start Analysis</button>
        </div>

        <!-- Screen 2: File Upload Screen -->
        <div class="screen" id="screen2">
            <h2>Upload Audio File</h2>
            <input type="file" id="fileInput" accept=".mp3,.wav">
            <p class="note">Supported formats: MP3, WAV</p>
            <button onclick="showScreen(3)">Next</button>
        </div>

        <!-- Screen 3: Real-Time Analysis -->
        <div class="screen" id="screen3">
            <h2>Real-Time Analysis</h2>
            <p id="analyzingStatus">Analyzing...</p>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <canvas id="realTimeChart"></canvas>
            <button onclick="showScreen(4)">See Results</button>
        </div>

        <!-- Screen 4: Results Screen -->
        <div class="screen" id="screen4">
            <h2>Analysis Results</h2>
            <div id="keyInsights">
                <h3>Key Insights:</h3>
                <p>Overall Engagement: 8.3/10</p>
                <p>Peak Moments: 0:30, 2:15, 5:00</p>
                <p>Recommended Improvements: Vary pitch more frequently, increase pace in section 2</p>
            </div>
            <button onclick="generateReport()">Download Report</button>
            <a id="downloadLink" download="engagement_report.csv" style="display: none;">Download Full Report</a>
        </div>
    </div>

    <script>
        // Navigation function
        function showScreen(screenNumber) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(`screen${screenNumber}`).classList.add('active');
        }

        // Mock analysis and dynamic chart updates
        function startRealTimeAnalysis() {
            const progressBar = document.getElementById('progressBar');
            const ctx = document.getElementById('realTimeChart').getContext('2d');
            let progress = 0;

            const chart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'Engagement Score', data: [] }] },
            });

            const interval = setInterval(() => {
                if (progress >= 100) clearInterval(interval);
                else {
                    progress++;
                    progressBar.style.width = `${progress}%`;
                    chart.data.labels.push(`Chunk ${progress}`);
                    chart.data.datasets[0].data.push(Math.random() * 10);
                    chart.update();
                }
            }, 100);
        }

        function generateReport() {
            const data = [["Time", "Engagement Score"]];
            for (let i = 0; i < 10; i++) data.push([`00:${i * 10}`, (Math.random() * 10).toFixed(2)]);
            const csv = data.map(row => row.join(",")).join("\n");
            const blob = new Blob([csv], { type: 'text/csv' });
            document.getElementById('downloadLink').href = URL.createObjectURL(blob);
            document.getElementById('downloadLink').style.display = 'inline';
        }

        startRealTimeAnalysis();
    </script>
</body>
</html>
