<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InsightWave - Engagement Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* General Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }

    :root {
      --primary-color: #6C63FF;
      --secondary-color: #FFFFFF;
      --error-color: #FF6B6B;
      --success-color: #28C76F;
      --background-dark: #121212;
      --background-light: #1E1E1E;
      --text-light: #F0F0F0;
      --text-highlight: #A682FF;
      --padding: 16px;
      --border-radius: 8px;
    }

    body {
      background-color: var(--background-dark);
      color: var(--text-light);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      text-align: center;
      overflow: hidden;
    }

    .container {
      width: 90%;
      max-width: 800px;
      padding: var(--padding);
      background-color: var(--background-light);
      border-radius: var(--border-radius);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      margin-top: 20px;
      animation: fadeIn 0.5s ease-in-out;
    }

    h1 {
      font-size: 2.5em;
      color: var(--primary-color);
      margin-bottom: var(--padding);
    }

    p {
      color: var(--text-highlight);
      font-size: 1.2em;
    }

    .button {
      background-color: var(--primary-color);
      color: var(--secondary-color);
      padding: 15px 30px;
      font-size: 1.3em;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: 0.3s ease;
      margin-top: var(--padding);
    }

    .button:hover {
      background-color: #5A55FF;
      transform: scale(1.05);
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
    }

    .upload-box {
      border: 2px dashed var(--text-highlight);
      border-radius: var(--border-radius);
      padding: var(--padding);
      margin-top: var(--padding);
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .upload-box:hover {
      background-color: rgba(166, 130, 255, 0.1);
    }

    .graph-container {
      width: 100%;
      height: 300px;
      background-color: #333;
      border-radius: var(--border-radius);
      margin-top: var(--padding);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-highlight);
    }

    .progress-bar {
      width: 100%;
      height: 15px;
      background-color: #333;
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: var(--padding);
    }

    .progress {
      height: 100%;
      background-color: var(--text-highlight);
      width: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 768px) {
      h1 { font-size: 1.8em; }
      .button { font-size: 1em; padding: 10px 20px; }
    }
  </style>
</head>
<body>

  <!-- Start Screen -->
  <div class="container" id="start-screen">
    <h1>Welcome to InsightWave</h1>
    <p>Analyze your audio to uncover insights into engagement and sentiment</p>
    <button class="button" onclick="goToUploadScreen()">Start Analysis</button>
  </div>

  <!-- Upload File Screen -->
  <div class="container" id="upload-file-screen" style="display:none;">
    <h1>Upload Audio File</h1>
    <div class="upload-box" onclick="document.getElementById('file-input').click()">
      Drag and drop or click to select your audio file
      <input type="file" id="file-input" accept=".mp3,.mp4,.wav" style="display:none;" onchange="validateFile()">
    </div>
    <button class="button" id="next-btn" onclick="goToAnalysisScreen()" style="opacity: 0.5;" disabled>Next</button>
  </div>

  <!-- Real-Time Analysis Screen -->
  <div class="container" id="analysis-screen" style="display:none;">
    <h1>Real-Time Analysis</h1>
    <p>Analyzing engagement and sentiment in real-time...</p>
    <div class="progress-bar">
      <div class="progress" id="progress"></div>
    </div>
    <canvas id="fftCanvas" width="400" height="300"></canvas>
    <button class="button" onclick="goToResultsScreen()">View Results</button>
  </div>

  <!-- Results Screen -->
  <div class="container" id="results-screen" style="display:none;">
    <h1>Analysis Results</h1>
    <p><strong>Overall Engagement Score:</strong> <span id="engagement-score">8.5</span>/10</p>
    <div id="sentiment-chart" class="graph-container"></div>
    <button class="button" onclick="downloadReport()">Download Report (PDF)</button>
    <button class="button" onclick="restart()">Analyze Another File</button>
  </div>

  <script>
    function goToUploadScreen() {
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('upload-file-screen').style.display = 'block';
    }

    function goToAnalysisScreen() {
      document.getElementById('upload-file-screen').style.display = 'none';
      document.getElementById('analysis-screen').style.display = 'block';
      startAnalysis();
    }

    function goToResultsScreen() {
      document.getElementById('analysis-screen').style.display = 'none';
      document.getElementById('results-screen').style.display = 'block';
    }

    function restart() {
      document.getElementById('results-screen').style.display = 'none';
      document.getElementById('start-screen').style.display = 'block';
      document.getElementById('next-btn').disabled = true;
      document.getElementById('next-btn').style.opacity = 0.5;
    }

    function validateFile() {
      const fileInput = document.getElementById('file-input');
      if (fileInput.files.length > 0) {
        document.getElementById('next-btn').disabled = false;
        document.getElementById('next-btn').style.opacity = 1;
      }
    }

    async function startAnalysis() {
      const file = document.getElementById('file-input').files[0];
      const formData = new FormData();
      formData.append('audio', file);

      const response = await fetch('/analyze', { method: 'POST', body: formData });
      const data = await response.json();

      renderFFT(data.fft);
      renderSentiment(data.sentiment);
    }

    function renderFFT(fftData) {
      const ctx = document.getElementById('fftCanvas').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({ length: fftData.length }, (_, i) => i),
          datasets: [{ data: fftData, borderColor: '#6C63FF', fill: false }]
        },
        options: { responsive: true }
      });
    }

    function renderSentiment(sentimentData) {
      const svg = d3.select('#sentiment-chart').append('svg').attr('width', 400).attr('height', 300);
      svg.selectAll('rect')
        .data(sentimentData)
        .enter()
        .append('rect')
        .attr('x', (d, i) => i * 50)
        .attr('y', d => 300 - d.value * 300)
        .attr('width', 40)
        .attr('height', d => d.value * 300)
        .style('fill', d => d.type === 'positive' ? '#4caf50' : '#f44336');
    }

    function downloadReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text('Engagement Analysis Report', 10, 10);
      doc.text('Overall Engagement Score: 8.5/10', 10, 20);
      doc.save('Engagement_Report.pdf');
    }
  </script>

</body>
</html>
